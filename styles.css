/* =========================================================
   ChatGPT Ambient Blur — FULL styles.css
   - Ambient background with bottom gradient
   - Top-weighted white haze over image (Option A)
   - Glass composer only when NOT in legacy
   - Legacy composer = stock gray, untouched
   - Upload chips/previews stay visible
   - Bottom bar/fade removed in BOTH modes
   ========================================================= */

/* only make the page transparent when our bg is active */
html.cgpt-ambient-on,
html.cgpt-ambient-on body {
  background: transparent !important;
}

/* fixed, behind everything, non-interactive */
#cgpt-ambient-bg {
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
}

/* stretch inner elements */
#cgpt-ambient-bg picture,
#cgpt-ambient-bg img,
#cgpt-ambient-bg .haze,
#cgpt-ambient-bg .overlay {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

/* blur + slightly darker image */
#cgpt-ambient-bg img {
  object-fit: cover;
  transform: scale(1.08);
  filter: blur(60px) brightness(0.55);
  opacity: 0.58;
  will-change: transform, filter;
  z-index: 0; /* base layer */
}

/* ===== Option A: top-weighted white haze ABOVE the black overlay ===== */
#cgpt-ambient-bg .haze {
  pointer-events: none;
  z-index: 2; /* sits above .overlay */
  background: linear-gradient(
    to bottom,
    rgba(255,255,255,0.16) 0%,
    rgba(255,255,255,0.10) 22%,
    rgba(255,255,255,0.06) 45%,
    rgba(255,255,255,0.02) 68%,
    rgba(255,255,255,0.00) 85%
  );
}

/* bottom gradient (black → transparent), kept UNDER the haze */
html.cgpt-ambient-on #cgpt-ambient-bg .overlay {
  pointer-events: none !important;
  z-index: 1; /* below .haze, above the image */
  background: linear-gradient(
    to top,
    rgba(0, 0, 0, 0.92) 0%,
    rgba(0, 0, 0, 0.75) 18%,
    rgba(0, 0, 0, 0.50) 36%,
    rgba(0, 0, 0, 0.24) 60%,
    rgba(0, 0, 0, 0.00) 80%
  ) !important;
}

/* =========================================================
   Composer styling
   ========================================================= */

/* Glass look — ONLY when NOT in legacy mode */
html.cgpt-ambient-on:not(.cgpt-legacy-composer)
  form[data-type="unified-composer"]
  > div:is(.bg-token-bg-primary, [class*="dark:bg"]) {
  background: rgba(255,255,255,0.10) !important;
  border: 1px solid rgba(255,255,255,0.28) !important;
  box-shadow: 0 6px 26px rgba(0,0,0,.20) !important;
  -webkit-backdrop-filter: blur(14px) saturate(140%) !important;
  backdrop-filter: blur(14px) saturate(140%) !important;
}
@media (prefers-color-scheme: dark) {
  html.cgpt-ambient-on:not(.cgpt-legacy-composer)
    form[data-type="unified-composer"]
    > div:is(.bg-token-bg-primary, [class*="dark:bg"]) {
    background: rgba(0,0,0,0.35) !important;
    border: 1px solid rgba(255,255,255,0.14) !important;
    box-shadow: 0 8px 30px rgba(0,0,0,.40) !important;
  }
}

/* keep the editor area transparent only in glass mode */
html.cgpt-ambient-on:not(.cgpt-legacy-composer)
  form[data-type="unified-composer"] .ProseMirror,
html.cgpt-ambient-on:not(.cgpt-legacy-composer)
  form[data-type="unified-composer"] textarea {
  background: transparent !important;
}

/* Legacy mode: DO NOT override the composer;
   let the site’s stock gray render naturally */

/* =========================================================
   Safer page neutralization
   ========================================================= */

/* only neutralize the big page wrappers */
html.cgpt-ambient-on :is(main, #__next) {
  background-color: transparent !important;
}

/* ===== remove the bottom page bar/fade in BOTH modes ===== */
html.cgpt-ambient-on #thread-bottom-container {
  background: transparent !important;   /* kills the gray bar surface */
  box-shadow: none !important;
}

/* remove any gradient mask it applies */
html.cgpt-ambient-on #thread-bottom-container.content-fade,
html.cgpt-ambient-on #thread-bottom-container .content-fade {
  -webkit-mask-image: none !important;
  mask-image: none !important;
}

/* some builds paint the fade via pseudos — strip those */
html.cgpt-ambient-on #thread-bottom-container::before,
html.cgpt-ambient-on #thread-bottom-container::after,
html.cgpt-ambient-on #thread-bottom-container .content-fade::before,
html.cgpt-ambient-on #thread-bottom-container .content-fade::after {
  content: none !important;
  background: none !important;
}

/* footer line (“ChatGPT can make mistakes…”) — ensure no bar */
html.cgpt-ambient-on #thread-bottom-container .text-token-text-secondary {
  background: transparent !important;
}

/* =========================================================
   Transparent top header (keep content, remove gray bar)
   ========================================================= */

html.cgpt-ambient-on header#page-header {
  /* nuke the gray box */
  background: transparent !important;
  box-shadow: none !important;          /* kills [box-shadow:var(--sharp-edge-top-shadow)] */
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
}

/* just in case any pseudo paints it */
html.cgpt-ambient-on header#page-header::before,
html.cgpt-ambient-on header#page-header::after {
  content: none !important;
  background: none !important;
  box-shadow: none !important;
}

/* if the site sets the gray via this token class on the header element */
html.cgpt-ambient-on header#page-header.bg-token-main-surface-primary {
  background-color: transparent !important;
}

/* =========================================================
   Popovers & dropdown menus — glass (respects Legacy toggle)
   ========================================================= */

/* main popover panel (Radix menu content) */
html.cgpt-ambient-on:not(.cgpt-legacy-composer)
  .popover.bg-token-main-surface-primary[data-radix-menu-content] {
  background: rgba(255, 255, 255, 0.10) !important;
  border: 1px solid rgba(255, 255, 255, 0.28) !important;
  -webkit-backdrop-filter: blur(14px) saturate(140%) !important;
  backdrop-filter: blur(14px) saturate(140%) !important;
  box-shadow: 0 16px 50px rgba(0, 0, 0, 0.45) !important; /* a touch deeper than composer */
}

/* dark scheme tweak */
@media (prefers-color-scheme: dark) {
  html.cgpt-ambient-on:not(.cgpt-legacy-composer)
    .popover.bg-token-main-surface-primary[data-radix-menu-content] {
    background: rgba(0, 0, 0, 0.35) !important;
    border-color: rgba(255, 255, 255, 0.14) !important;
  }
}

/* keep section separators visible on glass (optional) */
html.cgpt-ambient-on:not(.cgpt-legacy-composer)
  .popover[data-radix-menu-content] [role="group"]::before {
  /* replaces token separator color with a subtle line */
  background: color-mix(in oklab, currentColor 24%, transparent) !important;
}

/* nicer hover inside glass menus (optional) */
html.cgpt-ambient-on:not(.cgpt-legacy-composer)
  .popover[data-radix-menu-content] .__menu-item:hover {
  background: color-mix(in oklab, currentColor 12%, transparent) !important;
}

/* =========================================================
   Light mode overrides
   ========================================================= */

/* lighten the blurred image and invert gradient emphasis */
html.cgpt-ambient-on.cgpt-light-mode #cgpt-ambient-bg img {
  filter: blur(60px) brightness(1.1);
  opacity: 0.74;
}

html.cgpt-ambient-on.cgpt-light-mode #cgpt-ambient-bg .haze {
  background: linear-gradient(
    to bottom,
    rgba(0,0,0,0.14) 0%,
    rgba(0,0,0,0.08) 22%,
    rgba(0,0,0,0.04) 45%,
    rgba(0,0,0,0.02) 68%,
    rgba(0,0,0,0.00) 85%
  );
}

html.cgpt-ambient-on.cgpt-light-mode #cgpt-ambient-bg .overlay {
  background: linear-gradient(
    to top,
    rgba(255,255,255,0.90) 0%,
    rgba(255,255,255,0.70) 18%,
    rgba(255,255,255,0.45) 36%,
    rgba(255,255,255,0.20) 60%,
    rgba(255,255,255,0.00) 80%
  ) !important;
}

/* composer glass defaults for forced light mode */
html.cgpt-ambient-on.cgpt-light-mode:not(.cgpt-legacy-composer)
  form[data-type="unified-composer"]
  > div:is(.bg-token-bg-primary, [class*="dark:bg"]) {
  background: rgba(255,255,255,0.10) !important;
  border: 1px solid rgba(0,0,0,0.06) !important;
  box-shadow: 0 6px 26px rgba(0,0,0,.20) !important;
}

html.cgpt-ambient-on.cgpt-light-mode:not(.cgpt-legacy-composer)
  .popover.bg-token-main-surface-primary[data-radix-menu-content] {
  background: rgba(255,255,255,0.28) !important;
  border-color: rgba(0,0,0,0.06) !important;
}
